# LNMP运维面板使用教程

## 目录
1. [安装部署](#安装部署)
2. [功能使用](#功能使用)
3. [常见问题](#常见问题)
4. [配置示例](#配置示例)

## 安装部署

### 系统要求
- 操作系统: Linux (Debian/Ubuntu/CentOS/Raspbian等)
- 架构: ARMv7l (兼容其他架构但优化效果最佳)
- 内存: 最低512MB，推荐1GB+
- 存储: 100MB可用空间

### 快速安装

#### 方法一：一键安装脚本
```bash
# 下载安装脚本
wget https://raw.githubusercontent.com/your-repo/lnmp-panel/main/deploy/install.sh
chmod +x install.sh

# 执行安装
sudo ./install.sh
```

#### 方法二：手动安装
```bash
# 创建用户和目录
sudo useradd -r -s /bin/false -d /opt/lnmp-panel lnmp-panel
sudo mkdir -p /opt/lnmp-panel

# 下载二进制文件
cd /opt/lnmp-panel
sudo wget https://github.com/your-repo/lnmp-panel/releases/latest/lnmp-panel-armv7l
sudo mv lnmp-panel-armv7l lnmp-panel
sudo chmod +x lnmp-panel

# 创建配置文件
sudo cat > config.json << EOF
{
    "port": 8080,
    "web_root": "/var/www/html",
    "log_path": "/var/log",
    "services": ["nginx", "mysql", "php-fpm"]
}
EOF

# 设置权限
sudo chown -R lnmp-panel:lnmp-panel /opt/lnmp-panel

# 创建系统服务
sudo cat > /etc/systemd/system/lnmp-panel.service << EOF
[Unit]
Description=LNMP运维面板
After=network.target

[Service]
Type=simple
User=lnmp-panel
Group=lnmp-panel
WorkingDirectory=/opt/lnmp-panel
ExecStart=/opt/lnmp-panel/lnmp-panel
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# 启动服务
sudo systemctl daemon-reload
sudo systemctl enable lnmp-panel
sudo systemctl start lnmp-panel
```

### Docker部署
```bash
# 拉取镜像
docker pull your-repo/lnmp-panel:armv7l

# 运行容器
docker run -d \
  --name lnmp-panel \
  -p 8080:8080 \
  -v /etc/nginx:/etc/nginx \
  -v /etc/mysql:/etc/mysql \
  -v /etc/php:/etc/php \
  -v /var/log:/var/log \
  your-repo/lnmp-panel:armv7l
```

## 功能使用

### 1. 访问面板
在浏览器中打开: `http://你的服务器IP:8080`

### 2. 服务管理

#### 查看服务状态
- 面板首页显示所有服务的运行状态
- 绿色指示灯表示服务运行中
- 红色指示灯表示服务已停止

#### 服务操作
- **启动服务**: 点击对应服务的"启动"按钮
- **停止服务**: 点击"停止"按钮  
- **重启服务**: 点击"重启"按钮

#### 支持的LNMP服务
- Nginx Web服务器
- MySQL数据库服务
- PHP-FPM进程管理器
- 其他自定义服务

### 3. 配置管理

#### 编辑配置文件
1. 在"配置管理"区域选择要编辑的服务
2. 配置文件内容将显示在编辑器中
3. 修改配置内容
4. 点击"保存配置"按钮

#### 配置文件路径
| 服务 | 默认配置文件路径 |
|------|-----------------|
| Nginx | /etc/nginx/nginx.conf |
| MySQL | /etc/mysql/my.cnf |
| PHP-FPM | /etc/php/fpm/php-fpm.conf |

### 4. 日志查看

#### 查看服务日志
1. 在"日志查看"区域选择服务
2. 选择要显示的日志行数(50/100/200/500)
3. 日志内容将实时显示

#### 日志文件位置
- Nginx日志: /var/log/nginx/
- MySQL日志: /var/log/mysql/
- PHP-FPM日志: /var/log/php-fpm.log
- 系统日志: /var/log/syslog

### 5. 系统监控

#### 查看系统信息
面板首页显示：
- 系统架构信息
- 内存使用情况
- 磁盘空间使用
- CPU信息

## 常见问题

### Q: 面板无法访问
**可能原因**: 端口被占用或防火墙阻止
**解决方案**:
```bash
# 检查端口占用
netstat -tulpn | grep 8080

# 开放防火墙端口
sudo ufw allow 8080
# 或
sudo firewall-cmd --add-port=8080/tcp --permanent
sudo firewall-cmd --reload
```

### Q: 服务状态显示异常
**可能原因**: 服务未安装或权限不足
**解决方案**:
```bash
# 检查服务是否安装
systemctl status nginx
systemctl status mysql
systemctl status php-fpm

# 安装缺失的服务
sudo apt install nginx mysql-server php-fpm
```

### Q: 配置保存失败
**可能原因**: 文件权限不足
**解决方案**:
```bash
# 检查文件权限
ls -la /etc/nginx/nginx.conf

# 修改权限（谨慎操作）
sudo chmod 644 /etc/nginx/nginx.conf
```

### Q: 日志无法查看
**可能原因**: 日志文件不存在或权限不足
**解决方案**:
```bash
# 检查日志文件
sudo ls -la /var/log/nginx/

# 确保日志目录可读
sudo chmod 755 /var/log/nginx/
```

### Q: ARMv7l设备性能问题
**优化建议**:
1. 减少同时运行的服务数量
2. 调整Nginx工作进程数
3. 优化PHP-FPM配置
4. 使用轻量级数据库替代MySQL

## 配置示例

### Nginx优化配置示例
```nginx
# /etc/nginx/nginx.conf
user www-data;
worker_processes auto;  # ARM设备建议设置为1或2
pid /run/nginx.pid;

events {
    worker_connections 768;
    # multi_accept on;
}

http {
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    # 限制缓冲区大小，减少内存占用
    client_body_buffer_size 8K;
    client_header_buffer_size 1k;
    client_max_body_size 1m;
    large_client_header_buffers 2 1k;

    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/json application/javascript text/xml;

    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}
```

### PHP-FPM ARM优化配置
```ini
; /etc/php/7.4/fpm/php-fpm.conf
[global]
pid = /run/php/php7.4-fpm.pid
error_log = /var/log/php7.4-fpm.log

[www]
user = www-data
group = www-data
listen = /run/php/php7.4-fpm.sock
listen.owner = www-data
listen.group = www-data

; ARM设备优化配置
pm = dynamic
pm.max_children = 5           # 减少子进程数量
pm.start_servers = 2          # 减少启动进程数
pm.min_spare_servers = 1      # 最小空闲进程
pm.max_spare_servers = 3      # 最大空闲进程
pm.max_requests = 500         # 减少请求处理数

; 内存限制
php_admin_value[memory_limit] = 128M
```

### MySQL ARM优化配置
```ini
# /etc/mysql/my.cnf
[mysqld]
# ARM设备优化
innodb_buffer_pool_size = 64M          # 减少缓冲池大小
key_buffer_size = 16M                  # 减少键缓冲区
max_connections = 30                   # 减少最大连接数
query_cache_size = 16M                 # 查询缓存大小

# 性能优化
innodb_flush_log_at_trx_commit = 2
sync_binlog = 0

# 日志配置
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2

[mysql]
default-character-set = utf8mb4
```

### 系统服务配置示例
```ini
# /etc/systemd/system/lnmp-panel.service
[Unit]
Description=LNMP运维面板
After=network.target
Wants=network.target

[Service]
Type=simple
User=lnmp-panel
Group=lnmp-panel
WorkingDirectory=/opt/lnmp-panel
ExecStart=/opt/lnmp-panel/lnmp-panel
Restart=always
RestartSec=5

; ARM设备资源限制
LimitNOFILE=65536
MemoryLimit=256M
CPUQuota=80%

[Install]
WantedBy=multi-user.target
```

## 高级功能

### 自定义服务添加
要添加新的服务到面板管理：

1. 修改配置文件 `/opt/lnmp-panel/config.json`
```json
{
    "services": ["nginx", "mysql", "php-fpm", "redis", "memcached"]
}
```

2. 重启面板服务
```bash
sudo systemctl restart lnmp-panel
```

### 备份与恢复
建议定期备份重要配置文件：
```bash
# 备份配置
sudo tar -czf lnmp-backup-$(date +%Y%m%d).tar.gz \
  /etc/nginx/ /etc/mysql/ /etc/php/ /opt/lnmp-panel/

# 恢复配置
sudo tar -xzf lnmp-backup-20240101.tar.gz -C /
```

## 安全建议

1. **修改默认端口**: 生产环境建议使用非8080端口
2. **启用HTTPS**: 配置SSL证书加密通信
3. **访问控制**: 配置防火墙限制访问IP
4. **定期更新**: 及时更新面板版本
5. **日志监控**: 定期检查系统日志